// =============================================================================
// BIND Configuration - Intentionally Permissive for Testing
// =============================================================================

options {
    directory "/var/cache/bind";

    // Listen on all interfaces
    listen-on { any; };
    listen-on-v6 { any; };

    // Allow queries from any source (testing)
    allow-query { any; };

    // Allow zone transfers from any source (intentionally insecure)
    allow-transfer { any; };

    // Allow recursion (for testing)
    recursion yes;
    allow-recursion { any; };

    // Forwarders for external resolution
    forwarders {
        8.8.8.8;
        8.8.4.4;
    };

    // DNSSEC disabled for simplicity
    dnssec-validation no;

    // Version string (information disclosure)
    version "BIND 9.x - CPTC11 Test Server";

    // Logging
    querylog yes;
};

// Logging configuration
logging {
    channel default_log {
        file "/var/log/bind/default.log" versions 3 size 5m;
        severity info;
        print-time yes;
        print-category yes;
    };

    channel query_log {
        file "/var/log/bind/queries.log" versions 3 size 10m;
        severity debug;
        print-time yes;
    };

    category default { default_log; };
    category queries { query_log; };
};

// Zone definitions
zone "." {
    type hint;
    file "/etc/bind/zones/db.root";
};

zone "localhost" {
    type master;
    file "/etc/bind/zones/db.localhost";
};

zone "127.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.127";
};

// Main test domain - zone transfer enabled
zone "testlab.local" {
    type master;
    file "/etc/bind/zones/db.testlab.local";
    allow-transfer { any; };
    allow-query { any; };
};

// Reverse DNS for test networks
zone "10.10.10.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.10.10.10";
    allow-transfer { any; };
};

zone "20.10.10.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.10.10.20";
    allow-transfer { any; };
};
